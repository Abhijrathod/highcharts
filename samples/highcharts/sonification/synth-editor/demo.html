<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/draggable-points.js"></script>
<script src="https://code.highcharts.com/modules/sonification.js"></script>

<main>
  <h1>Synth Patch Editor</h1>
  <div class="row firstrow">
    <p id="intro">Play the synth using the <span class="code">A</span> to <span class="code">L</span> and <span class="code">W</span> to <span class="code">O</span> keys on your keyboard, simulating white and black keys on a piano.</p>
    <p id="keyStatus">Synth not started</p>
  </div>

  <button id="startSynth">Start synth</button>

  <div id="controls" class="hidden">
      <div class="row">
        <label id="presetLabel">Preset <select id="preset"></select></label>
        <button id="playWideRange">Play wide range</button>
        <button id="showHelp">Help</button>
      </div>

      <div id="help" class="hidden">
        <h2>Help</h2>
        <p>Note: The synth can overdrive if you set volume too high or add many oscillators to play at once without lowering their volumes.</p>
        <p>To create volume envelopes, click in the charts to add points. The points can be dragged, or clicked to delete.</p>
        <p>The tracking multiplier parameters are used for frequency dependent behavior. For example, by setting the volume tracking multiplier to 0.01, the volume will be lower at higher notes. The multiplier is a logarithmic function, where 1 is at ca 50Hz, and you define the output for an input frequency around 3.2kHz.</p>
        <p>The FM and VM oscillator parameters are used for frequency modulation (FM) and volume modulation (VM). Set this parameter to one of the other oscillators to modulate its frequency or volume.</p>
      </div>

      <div id="globalControls">
        <div>
          <h2>Global controls</h2>
          <label>Master volume <input id="masterVolume" min="0.1" max="1" step="0.05" type="range" value="0.8"></label>
          <label>Glide between notes <input id="glideDuration" type="number" value="0"></label>
        </div>
        <div>
          <h3>Master Attack Envelope</h3>
          <div id="masterAttackEnvChart" class="chart"></div>
        </div>
        <div>
          <h3>Master Release Envelope</h3>
          <div id="masterReleaseEnvChart" class="chart"></div>
        </div>
        <div id="masterEQ">
          <div class="row">
            <h3>Master Parametric EQ (gain, frequency, Q)</h3>
            <button id="resetEQ">Reset</button>
          </div>
          <div id="eqSliders" class="row"></div>
        </div>
      </div>
  
      <div class="row">
        <h2>Oscillators</h2>
        <button id="addOsc">+ Add oscillator</button>
      </div>
      <div id="oscillators" class="row">
      </div>

      <h2>Generated Patch JSON</h2>
      <textarea readonly id="json">{}</textarea>
  </div>
</main>



<!-- ----------------------------------------- PRESETS STORED BELOW ------------------------------------------------ -->

<div id="presets" class="hidden">
  <div id="preset-basic">
    {
      "masterVolume": "0.8",
      "oscillators": [
       {
        "type": "sine",
        "lowpass": {},
        "highpass": {},
        "attackEnvelope": [],
        "releaseEnvelope": []
       }
      ]
     }
  </div>
  <div id="preset-whirlwind">
    {
      "masterVolume": "0.75",
      "noteGlideDuration": "400",
      "masterReleaseEnvelope": [
       {
        "t": 0,
        "vol": 1
       },
       {
        "t": 124,
        "vol": 0.24
       },
       {
        "t": 281,
        "vol": 0
       }
      ],
      "oscillators": [
       {
        "type": "whitenoise",
        "volume": 1,
        "lowpass": {
         "frequency": 100,
         "frequencyPitchTrackingMultiplier": 6,
         "Q": 23
        },
        "highpass": {
         "frequency": 100,
         "frequencyPitchTrackingMultiplier": 6
        }
       },
       {
        "type": "sine",
        "freqMultiplier": 0.016,
        "volume": 1000,
        "fmOscillator": 0
       }
      ]
     }
  </div>
  <div id="preset-advanced">
    {
      "masterVolume": "0.8",
      "eq": [
       {
        "frequency": 2500,
        "Q": 10,
        "gain": -12
       }
      ],
      "oscillators": [
       {
        "type": "sine",
        "volume": 0.5,
        "lowpass": {},
        "highpass": {},
        "attackEnvelope": [],
        "releaseEnvelope": []
       }
      ]
     }
  </div>

</div>